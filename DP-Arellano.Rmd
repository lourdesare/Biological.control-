---
title: "Biological control of important fungal diseases of potato and raspberry by two *Bacillus velezensis* strains"
author: "Lourdes Arellano, Antonia Fernandes, Juliana Cajiao and Rosario Heribia"
date: "21/12/2021"
output:
  html_document:
    code_folding: hide
---
## Objectives

Demonstrate the potential effect of *B. velezensis* strains  against *R. solani* as a biological control, and a potential increasement in the plant growth of potato. 

## Hypothesis

*B. velezensis* strains can be used as biological control agents against *R. solani*, and increase significantly the plant growth of potato. 

## Methods


**1. Dowload Data:**
First, dowload the raw data of the paper that is in the link: 
<https://dfzljdn9uc3pi.cloudfront.net/2021/11578/1/peerj-55829-Raw_data.xls>

```{r}
if(!dir.exists("data")) dir.create("data")
download.file("https://dfzljdn9uc3pi.cloudfront.net/2021/11578/1/peerj-55829-Raw_data.xls",
              "data/rawdata.xls")
```

**2. Open and Arrange Data:** 
```{r}
library(readxl)
readxl::excel_sheets("data/peerj-55829-Raw_data.xls")
dir("data")
#dir("C:\Users\lsare\Desktop\Plant Health\Estadistica\Biologicalcontrol\data\")
library(readxl)
#AntagonisticActivity <- read_excel("data/peerj-55829-Raw_data.xls")

#Open sheets with ranges 
AntagonisticActivity <-
  read_excel("data/peerj-55829-Raw_data.xls",
             sheet = "Antagonistic activity",
             range = "A3:E38")
DiseaseIncidenceAndSeverity <- read_excel("data/peerj-55829-Raw_data.xls",
                                          sheet = "disease incidence and severity",
                                          range = "A4:N40")
MorphometricCharactOfPotato <- read_excel("data/peerj-55829-Raw_data.xls",
                                          sheet = "morphometric charact of potato",)
BiomassDistribution <- read_excel("data/peerj-55829-Raw_data.xls",sheet = "biomass distribution")
YieldOfPotato <- read_excel("data/peerj-55829-Raw_data.xls",
                            sheet = "yield of potato",
                            range = "B3:I15")
#Fill 
library(tidyr)
library(dplyr)
AntagonisticActivity <- AntagonisticActivity %>% fill(everything(), .direction = "down")
BiomassDistribution <- BiomassDistribution %>% fill(everything(), .direction = "down")
DiseaseIncidenceAndSeverity <- DiseaseIncidenceAndSeverity %>% fill(everything(), .direction = "down")
MorphometricCharactOfPotato <- MorphometricCharactOfPotato %>% fill(everything(), .direction = "down")
YieldOfPotato <- YieldOfPotato %>% fill(everything(), .direction = "down")

#Rename 
library(dplyr)
names(AntagonisticActivity)[names(AntagonisticActivity) == 'strain'] <- "Strain"
names(AntagonisticActivity)[names(AntagonisticActivity) == 'CFU/ml'] <- "Concentration"

#Pivot longer 
AntagonisticActivity <- pivot_longer(AntagonisticActivity,cols= c("3d", "5d", "7d"), names_to="Days", values_to="Colony.Diameter")

#change potencia
AntagonisticActivity$Concentration
a <- as.numeric(substr(AntagonisticActivity$Concentration, 1, 2))
b <- as.numeric(substr(AntagonisticActivity$Concentration, 3, 3))
a^b
AntagonisticActivity$Concentration <- a^b
rm(a,b)

#Create new column for treatments
AntagonisticActivity$Trat <- paste(AntagonisticActivity$Strain,AntagonisticActivity$Concentration)

#Join data frame 
library(dplyr)
Data.Cultivars <- full_join(MorphometricCharactOfPotato, DiseaseIncidenceAndSeverity, by = c("Cultivar","Year", "Treatment","Weeks after planting"))

#Rename 
library(dplyr)
names(Data.Cultivars)[names(Data.Cultivars) == 'Plant height, cm'] <- "1"
names(Data.Cultivars)[names(Data.Cultivars) == '...6.x'] <- "2"
names(Data.Cultivars)[names(Data.Cultivars) == '...7.x'] <- "3"
names(Data.Cultivars)[names(Data.Cultivars) == '...8.x'] <- "4"
names(Data.Cultivars)[names(Data.Cultivars) == '...9.x'] <- "5"
#Pivot longer 
Data.Cultivars <- pivot_longer(Data.Cultivars,cols= c("1", "2", "3","4","5"), names_to="Rep", values_to="Plant.Height")

#Create empty new columns 
Data.Cultivars$Disease.Incidence <- NA
Data.Cultivars$Disease.Severity <- NA
Data.Cultivars$Stems <- NA

#Add data to the columns 
variables <- c("Disease incidence, %","...6.y","...7.y","...8.y","...9.y")
for (i in 1:5) {
  A <- Data.Cultivars$Rep==i
  Data.Cultivars$Disease.Incidence[A] <- Data.Cultivars[[variables[i]]][A]
}

Data.Cultivars$Stems <- NA
variables1 <- c("The number of stems per plant","...11.x","...12.x","...13.x","...14.x")
for (i in 1:5) {
  A1 <- Data.Cultivars$Rep==i
  Data.Cultivars$Stems[A1] <- Data.Cultivars[[variables1[i]]][A1]
}

Data.Cultivars$Disease.Severity <- NA
variables1 <- c("Disease severity, %","...11.y","...12.y","...13.y","...14.y")
for (i in 1:5) {
  A2 <- Data.Cultivars$Rep==i
  Data.Cultivars$Disease.Severity[A2] <- Data.Cultivars[[variables1[i]]][A2]
}


#dataframe with variables that I need 
namesdatacultivar <- c("Cultivar","Treatment","Year","Weeks after planting", "Rep","Plant.Height","Disease.Incidence","Disease.Severity","Stems")           
Data.Cultivars.Final <- Data.Cultivars [which(names(Data.Cultivars) %in% namesdatacultivar)]

#Yieldofpotato 
#Rename 
library(dplyr)
names(YieldOfPotato)[names(YieldOfPotato) == 'Yield, t ha-1'] <- "1"
names(YieldOfPotato)[names(YieldOfPotato) == '...5'] <- "2"
names(YieldOfPotato)[names(YieldOfPotato) == '...6'] <- "3"
names(YieldOfPotato)[names(YieldOfPotato) == '...7'] <- "4"
names(YieldOfPotato)[names(YieldOfPotato) == '...8'] <- "5"
#Pivot longer 
YieldOfPotato <- pivot_longer(YieldOfPotato,cols= c("1", "2", "3","4","5"), names_to="Rep", values_to="Yield.Potato")

#BiomassDistribution
#Rename 
library(dplyr)
names(BiomassDistribution)[names(BiomassDistribution) == 'Biomass distribution by fractions, %'] <- "1"
names(BiomassDistribution)[names(BiomassDistribution) == '...6'] <- "2"
names(BiomassDistribution)[names(BiomassDistribution) == '...7'] <- "3"
names(BiomassDistribution)[names(BiomassDistribution) == '...8'] <- "4"
names(BiomassDistribution)[names(BiomassDistribution) == '...9'] <- "5"
#Pivot longer 
BiomassDistribution <- pivot_longer(BiomassDistribution,cols= c("1", "2", "3","4","5"), names_to="Rep", values_to="Percentage.Biomass")

#create a sheet for medium fraction
medium.fraction <- BiomassDistribution[BiomassDistribution$Fractions=="medium",]

#join sheets of yield and medium fraction
names(YieldOfPotato)[names(YieldOfPotato) == 'Bacillus strain'] <- "Treatment"
YieldOfPotato <- full_join(YieldOfPotato,medium.fraction)
YieldOfPotato <- YieldOfPotato[,-which(names(YieldOfPotato)=="Fractions")]

#remove sheets
ls()
rm("Data.Cultivars","DiseaseIncidenceAndSeverity","medium.fraction","MorphometricCharactOfPotato")

```
## Analysis 

Comparation between ANOVA and Duncan test in this three data sets: 

&nbsp;

**1) Antifungal activity of B. velezensis against *R solani* in vitro.** 


Strains:

1. *Bacillus velezensis* strain BZR 336 g

2. *Bacillus velezensis* strain BZR 517

3. Control 


Treatments:
 
1. 10^4 CFU/mL
  
2. 10^5 CFU/mL
  
3. 10^6 CFU/mL
  
4. Control.

###### CFU: Colony-Forming Unit


Days:

* 3

* 5

* 7 

Variables: 

* Colony Diameter (cm)


&nbsp;

**2) Effect of *B. velezensis* strains on disease incidence and severity and morphometric parameters caused by *R. solani* on two potato cultivars differed by disease resistance during 2015 and 2016 growing seasons in Western Siberia**


Cultivars:

1. Svitanok kievskiy 

2. Yuna


Years:

* 2015

* 2016


Treatments:

1. Control

2. BZR 336g 

3. BZR 517


Weeks after planting:

* 4

* 6

* 10


Variables: (5 rep/treatment)

1. Disease incidence % 

2. Disease severity

3. Plant height (cm) 

4. Number of stems per plant


&nbsp;
```{r}
#Analysis Data.Cultivars.Final

library(agricolae)

########### GRAFICS

# Plant Height
model<-aov(Plant.Height~Treatment+`Weeks after planting`+Year, data=Data.Cultivars.Final)
summary(model)

Data.Cultivars.Final$`Weeks after planting` <- factor(Data.Cultivars.Final$`Weeks after planting`)

library(ggplot2)
#ggplot(Data.Cultivars.Final, aes(x=`Weeks after planting`, y=Plant.Height, fill=Treatment))+
  #geom_boxplot()+
  #facet_grid(Cultivar~Year)+
  #theme_light()

# Disease Incidence
model<-aov(Disease.Incidence~Treatment+`Weeks after planting`+Year, data=Data.Cultivars.Final)
summary(model)

Data.Cultivars.Final$`Weeks after planting` <- factor(Data.Cultivars.Final$`Weeks after planting`)

library(ggplot2)
#ggplot(Data.Cultivars.Final, aes(x=`Weeks after planting`, y=Disease.Incidence, fill=Treatment))+
  #geom_boxplot()+
  #facet_grid(Cultivar~Year)+
  #theme_light()

# Disease Severity
model<-aov(Disease.Severity~Treatment+`Weeks after planting`+Year, data=Data.Cultivars.Final)
summary(model)

Data.Cultivars.Final$`Weeks after planting` <- factor(Data.Cultivars.Final$`Weeks after planting`)

library(ggplot2)
#ggplot(Data.Cultivars.Final, aes(x=`Weeks after planting`, y=Disease.Severity, fill=Treatment))+
  #geom_boxplot()+
  #facet_grid(Cultivar~Year)+
  #theme_light()

#Stems
model<-aov(Stems~Treatment+`Weeks after planting`+Year, data=Data.Cultivars.Final)
summary(model)

Data.Cultivars.Final$`Weeks after planting` <- factor(Data.Cultivars.Final$`Weeks after planting`)

library(ggplot2)
#ggplot(Data.Cultivars.Final, aes(x=`Weeks after planting`, y=Stems, fill=Treatment))+
  #geom_boxplot()+
  #facet_grid(Cultivar~Year)+
  #theme_light()



########### DUNCAN TEST

## Plant Height

Y <- W <- Tr <- L <- C <- M <- numeric()

for (i in 2015:2016) { 
  for (k in levels(as.factor(Data.Cultivars.Final$Cultivar))) {
  for(j in levels(Data.Cultivars.Final$`Weeks after planting`)) {
  d1 <- Data.Cultivars.Final[Data.Cultivars.Final$Year==i & 
                               Data.Cultivars.Final$`Weeks after planting`==j &
                               Data.Cultivars.Final$Cultivar==k, ]
  model <- aov(Plant.Height~Treatment, data=d1)
  summary(model)
  DT <- duncan.test(model, "Treatment", console = TRUE)
  Y <- c(Y, i,i,i)
  W <- c(W, j,j,j)
  C <- c(C, k,k,k)
  Tr <- c(Tr, row.names(DT$groups))
  L <- c(L, DT$groups$groups)
  M <- c(M, DT$groups$Plant.Height)
  } 
  }
}


LettersPH <- data.frame(Year = Y, `Weeks after planting` = factor(W), 
                        Cultivar = C, Treatment = factor(Tr), letra = L, mea = M)

## Disease Incidence

Y <- W <- Tr <- L <- C <- M <- numeric()

for (i in 2015:2016) { 
  for (k in levels(as.factor(Data.Cultivars.Final$Cultivar))) {
    for(j in levels(Data.Cultivars.Final$`Weeks after planting`)) {
      d1 <- Data.Cultivars.Final[Data.Cultivars.Final$Year==i & 
                                   Data.Cultivars.Final$`Weeks after planting`==j &
                                   Data.Cultivars.Final$Cultivar==k, ]
      model <- aov(Disease.Incidence~Treatment, data=d1)
      summary(model)
      DT <- duncan.test(model, "Treatment", console = TRUE)
      Y <- c(Y, i,i,i)
      W <- c(W, j,j,j)
      C <- c(C, k,k,k)
      Tr <- c(Tr, row.names(DT$groups))
      L <- c(L, DT$groups$groups)
      M <- c(M, DT$groups$Disease.Incidence)
    } 
  }
}


LettersDI <- data.frame(Year = Y, `Weeks after planting` = factor(W), 
                        Cultivar = C, Treatment = factor(Tr), letra = L, mea = M)

## Disease Severity

Y <- W <- Tr <- L <- C <- M <- numeric()

for (i in 2015:2016) { 
  for (k in levels(as.factor(Data.Cultivars.Final$Cultivar))) {
    for(j in levels(Data.Cultivars.Final$`Weeks after planting`)) {
      d1 <- Data.Cultivars.Final[Data.Cultivars.Final$Year==i & 
                                   Data.Cultivars.Final$`Weeks after planting`==j &
                                   Data.Cultivars.Final$Cultivar==k, ]
      model <- aov(Disease.Severity~Treatment, data=d1)
      summary(model)
      DT <- duncan.test(model, "Treatment", console = TRUE)
      Y <- c(Y, i,i,i)
      W <- c(W, j,j,j)
      C <- c(C, k,k,k)
      Tr <- c(Tr, row.names(DT$groups))
      L <- c(L, DT$groups$groups)
      M <- c(M, DT$groups$Disease.Severity)
    } 
  }
}


LettersDS <- data.frame(Year = Y, `Weeks after planting` = factor(W), 
                        Cultivar = C, Treatment = factor(Tr), letra = L, mea = M)

## Stems

Y <- W <- Tr <- L <- C <- M <- numeric()

for (i in 2015:2016) { 
  for (k in levels(as.factor(Data.Cultivars.Final$Cultivar))) {
    for(j in levels(Data.Cultivars.Final$`Weeks after planting`)) {
      d1 <- Data.Cultivars.Final[Data.Cultivars.Final$Year==i & 
                                   Data.Cultivars.Final$`Weeks after planting`==j &
                                   Data.Cultivars.Final$Cultivar==k, ]
      model <- aov(Stems~Treatment, data=d1)
      summary(model)
      DT <- duncan.test(model, "Treatment", console = TRUE)
      Y <- c(Y, i,i,i)
      W <- c(W, j,j,j)
      C <- c(C, k,k,k)
      Tr <- c(Tr, row.names(DT$groups))
      L <- c(L, DT$groups$groups)
      M <- c(M, DT$groups$Stems)
    } 
  }
}


LettersST <- data.frame(Year = Y, `Weeks after planting` = factor(W), 
                        Cultivar = C, Treatment = factor(Tr), letra = L, mea = M)


#### Juntar letras en la grafica 

# Plant Height

ggplot(Data.Cultivars.Final, aes(x=`Weeks after planting`, y=Plant.Height, fill=Treatment))+
  geom_boxplot()+
  facet_grid(Cultivar~Year)+
  theme_light()+
  geom_text(data = LettersPH,
            mapping = aes(x = Weeks.after.planting,
                          y = mea + 5,
                          label = letra),
            position = position_dodge(0.9))+
  labs(caption = "Figure 3. Plant Height (cm)") +
  theme(plot.caption.position = "plot",
        plot.caption = element_text(hjust = 0))
            

## Disease Incidence

ggplot(Data.Cultivars.Final, aes(x=`Weeks after planting`, y=Disease.Incidence, fill=Treatment))+
  geom_boxplot()+
  facet_grid(Cultivar~Year)+
  theme_light()+
  geom_text(data = LettersDI,
            mapping = aes(x = Weeks.after.planting,
                          y = mea + 5,
                          label = letra),
            position = position_dodge(0.9))+
  labs(caption = "Figure No.4 Percentage of Disease incidence") +
  theme(plot.caption.position = "plot",
        plot.caption = element_text(hjust = 0))

## Disease Severity

ggplot(Data.Cultivars.Final, aes(x=`Weeks after planting`, y=Disease.Severity, fill=Treatment))+
  geom_boxplot()+
  facet_grid(Cultivar~Year)+
  theme_light()+
  geom_text(data = LettersDS,
            mapping = aes(x = Weeks.after.planting,
                          y = mea + 5,
                          label = letra),
            position = position_dodge(0.9))+
  labs(caption = "Figure No.5 Percentage of Disease severity") +
  theme(plot.caption.position = "plot",
        plot.caption = element_text(hjust = 0))


## Stems

ggplot(Data.Cultivars.Final, aes(x=`Weeks after planting`, y=Stems, fill=Treatment))+
  geom_boxplot()+ 
  facet_grid(Cultivar~Year)+
  theme_light()+
  geom_text(data = LettersST,
            mapping = aes(x = Weeks.after.planting,
                          y = mea + 1,
                          label = letra),
            position = position_dodge(0.9)) +
  labs(caption = "Figure No. 6 Number of stems in potato") +
  theme(plot.caption.position = "plot",
        plot.caption = element_text(hjust = 0))
```
**3) Effect of *B. velezens* strains on the biomass distribution of daughter tubers of two potato cultivars differed by disease resistance to *R. solani* and total yield during 2015 and 2016 growing seasons in Western Siberia.**


Cultivars:

1. Svitanok kievskiy 

2. Yuna


Years: 

* 2015

* 2016


Treatments:

1. Control 

2. BZR 336g

3. BZR 517


Fractions:

* Small

* Medium

* Large 


Variables: (5 rep/treatment)

1. Biomass distribution 
```{r}
#Biomass
model<-aov(Percentage.Biomass~Treatment+`Fractions`+Year, data=BiomassDistribution)
summary(model)

BiomassDistribution$`Fractions` <- factor(BiomassDistribution$`Fractions`)

library(ggplot2)
#ggplot(BiomassDistribution, aes(x=`Fractions`, y=Percentage.Biomass, fill=Treatment))+
  #geom_boxplot()+
 #facet_grid(Cultivar~Year)+
  #theme_light()

##Biomass for

Y <- W <- Tr <- L <- C <- M <- numeric()

for (i in 2015:2016) { 
  for (k in levels(as.factor(BiomassDistribution$Cultivar))) {
    for(j in levels(BiomassDistribution$`Fractions`)) {
      d200 <- BiomassDistribution[BiomassDistribution$Year==i & 
                                   BiomassDistribution$`Fractions`==j &
                                   BiomassDistribution$Cultivar==k, ]
      model <- aov(Percentage.Biomass~Treatment, data=d200)
      summary(model)
      DT <- duncan.test(model, "Treatment", console = TRUE)
      Y <- c(Y, i,i,i)
      W <- c(W, j,j,j)
      C <- c(C, k,k,k)
      Tr <- c(Tr, row.names(DT$groups))
      L <- c(L, DT$groups$groups)
      M <- c(M, DT$groups$Percentage.Biomass)
    } 
  }
}

#Biomass graph
LettersPH1 <- data.frame(Year = Y, `Fractions` = factor(W), 
                        Cultivar = C, Treatment = factor(Tr), letra = L, mea = M)

ggplot(BiomassDistribution, aes(x=`Fractions`, y=Percentage.Biomass, fill=Treatment))+
  geom_boxplot()+
  facet_grid(Cultivar~Year)+
  theme_light()+
  geom_text(data = LettersPH1,
            mapping = aes(x = Fractions,
                          y = mea + 5,
                          label = letra),
            position = position_dodge(0.9))+
  labs(caption = "Figure No. 7 Percentage of Biomass of potato") +
  theme(plot.caption.position = "plot",
        plot.caption = element_text(hjust = 0))


```

2. Yield (t/ha)
```{r}
library(agricolae)
library(ggplot2)
library(ggpubr)
#Anova and duncan Yield 2015 Svitanok kievskiy
#YieldOfPotato$Cultivar <- #factor(YieldOfPotato$Cultivar)
#Con <- YieldOfPotato$Cultivar == "Svitanok kievskiy" #& YieldOfPotato$Year==2015
#d1 <- YieldOfPotato[Con,]

#model<-aov(Yield.Potato~Treatment,data=d1)
#out <- duncan.test(model,"Treatment", 
                   #main="Yield of potato")
#plot(out,variation="IQR")
#out

#BZR 336g        28.78      a
#BZR 517         22.00      b
#Control         20.34      c 

#Anova and duncan Yield 2015 Yuna
#YieldOfPotato$Cultivar <- #factor(YieldOfPotato$Cultivar)
#Con1 <- YieldOfPotato$Cultivar == "Yuna" & #YieldOfPotato$Year==2015
#d2 <- YieldOfPotato[Con1,]

#model<-aov(Yield.Potato~Treatment,data=d2)
#out <- duncan.test(model,"Treatment", 
                   #main="Yield of potato")
#plot(out,variation="IQR")
#out

#BZR 336g         25.7      a
#BZR 517          24.6      a
#Control          21.0      b
#Anova and duncan Yield 2016 Svitanok kievskiy
#YieldOfPotato$Cultivar <- factor(YieldOfPotato$Cultivar)
#Con1234 <- YieldOfPotato$Cultivar == "Svitanok kievskiy" & YieldOfPotato$Year==2016
#d1234 <- YieldOfPotato[Con1234,]

#model<-aov(Yield.Potato~Treatment,data=d1234)
#out <- duncan.test(model,"Treatment", 
                   #main="Yield of potato")
#plot(out,variation="IQR")
#out
#BZR 336g         18.9      a
#BZR 517          16.5      b
#Control          11.6      c
#Anova and duncan Yield 2016 Yuna
#YieldOfPotato$Cultivar <- factor(YieldOfPotato$Cultivar)
#Con12345 <- YieldOfPotato$Cultivar == "Yuna" & YieldOfPotato$Year==2016
#d2345 <- YieldOfPotato[Con12345,]

#model<-aov(Yield.Potato~Treatment,data=d2345)
#out <- duncan.test(model,"Treatment", 
                   #main="Yield of potato")
#plot(out,variation="IQR")
#out
#BZR 336g        19.70      a
#BZR 517         19.62      a
#Control         15.46      b
###########Graph 
yield123 <- ggerrorplot(YieldOfPotato, x = "Cultivar", y = "Yield.Potato",
                     color = "Treatment", palette = "Paired", 
                     error.plot = "pointrange",
                     position = position_dodge(0.5),xlab = ("Cultivars"), ylab = ("Yield of potato (t/ha)"))+
  facet_grid(.~Year)+
  theme_light()+
  labs(caption = "Figure No. 8 Yield of potato (ha/t)") +
  theme(plot.caption.position = "plot",
        plot.caption = element_text(hjust = 0))
#yield123

#add letters
dat_text <- data.frame(
  label = c("a", "b", "c","a","a","b","a", "b", "c","a","a","b"),
  Year   = c(2015, 2015,2015,2015,2015,2015,2016,2016,2016,2016,2016,2016),
  x     = c(0.85, 1,1.2,1.83,2,2.17,0.85, 1,1.2,1.83,2,2.17),
  y     = c(29.3, 23.3,21.6, 27,26,21.8,19.8,17.3,12.3,20.55,20.6,16.1)
)

yield1234 <- yield123 + geom_text(
  data    = dat_text,
  mapping = aes(x = x, y = y, label = label)
)
yield1234
```

**Article:**  <https://peerj.com/articles/11578/#>

**Data:**
<https://dfzljdn9uc3pi.cloudfront.net/2021/11578/1/peerj-55829-Raw_data.xls>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


